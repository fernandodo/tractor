# ğŸ¯ã€Šå¦‚ä½•å®šä¹‰åªèƒ½åœ¨å †ä¸Šæˆ–æ ˆä¸Šç”Ÿæˆå¯¹è±¡çš„ç±»ã€‹æœ€ç»ˆæ€»ç»“ï¼ˆå« new/delete åŸç†ï¼‰

---

## ä¸€ã€é—®é¢˜ä¸æ ¸å¿ƒç›®æ ‡

> **è¦æ±‚ï¼š** é™å®šæŸä¸ªç±»åªèƒ½åœ¨â€œå †ä¸Šâ€æˆ–â€œæ ˆä¸Šâ€ç”Ÿæˆå¯¹è±¡ã€‚

æ ¸å¿ƒæ€æƒ³ï¼š
- ä¸é€šè¿‡è¿è¡Œæ—¶åˆ¤æ–­ï¼›
- è€Œæ˜¯é€šè¿‡ **ç¼–è¯‘æœŸè®¿é—®æ§åˆ¶** è®©é”™è¯¯åœ¨ç¼–è¯‘é˜¶æ®µæš´éœ²ï¼›
- æ§åˆ¶å¯¹è±¡åˆ›å»ºä¸é”€æ¯çš„ä¸¤ç«¯ï¼šæ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€operator new/deleteã€‚

---

## äºŒã€`new` ä¸ `delete` çš„åŸç†ä¸æ‰§è¡Œæµç¨‹

### âœ… new è¿ç®—ç¬¦æ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µï¼š

å½“æ‰§è¡Œï¼š
```cpp
MyClass* p = new MyClass();
```

ç¼–è¯‘å™¨ç”Ÿæˆä¸¤æ­¥ï¼š

1ï¸âƒ£ **åˆ†é…é˜¶æ®µ**
```cpp
void* raw = MyClass::operator new(sizeof(MyClass));
```
2ï¸âƒ£ **æ„é€ é˜¶æ®µ**
```cpp
new (raw) MyClass();
```
ğŸ§  å› æ­¤ï¼š
> `operator new` åªè´Ÿè´£åˆ†é…å†…å­˜ï¼Œä¸è°ƒç”¨æ„é€ å‡½æ•°ã€‚

---

### âœ… delete è¿ç®—ç¬¦æ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µï¼š

```cpp
delete p;
```
1ï¸âƒ£ è°ƒç”¨ææ„å‡½æ•°ï¼š `p->~MyClass();`  
2ï¸âƒ£ è°ƒç”¨ `MyClass::operator delete(p);`

---

| é˜¶æ®µ | æ“ä½œ | è°ƒç”¨å†…å®¹ |
|------|------|-----------|
| 1 | new åˆ†é… | `operator new` |
| 2 | new æ„é€  | `MyClass::MyClass()` |
| 3 | delete ææ„ | `MyClass::~MyClass()` |
| 4 | delete é‡Šæ”¾ | `operator delete` |

---

## ä¸‰ã€åªèƒ½åœ¨å †ä¸Šåˆ›å»ºå¯¹è±¡

### âœ… æ¨èå®ç°

```cpp
#include <memory>
class HeapOnly {
private:
    HeapOnly() {}
    ~HeapOnly() {}
    HeapOnly(const HeapOnly&) = delete;
    HeapOnly& operator=(const HeapOnly&) = delete;
public:
    static std::unique_ptr<HeapOnly> create() {
        return std::unique_ptr<HeapOnly>(new HeapOnly());
    }
};
```

- æ„é€ å‡½æ•°ç§æœ‰åŒ– â†’ å¤–éƒ¨æ— æ³• newï¼›  
- ææ„å‡½æ•°ç§æœ‰åŒ– â†’ å¤–éƒ¨æ— æ³• deleteï¼›  
- `create()` ä¸ºå”¯ä¸€å…¥å£ï¼›  
- è¿”å›æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨é‡Šæ”¾ï¼›  
- æ‹·è´/èµ‹å€¼è¢«ç¦ç”¨ï¼›  
- ç¼–è¯‘å™¨åœ¨ new æ—¶éªŒè¯æ„é€ å‡½æ•°è®¿é—®æƒé™ã€‚

---

### ğŸ’¡ æ‰‹åŠ¨ç®¡ç†ç‰ˆ

```cpp
class HeapOnly {
private:
    HeapOnly() {}
    ~HeapOnly() {}
public:
    static HeapOnly* create() { return new HeapOnly(); }
    void destroy() { delete this; }
};
```

---

### âš™ï¸ å¯é€‰ operator new é™åˆ¶å¤–éƒ¨å †åˆ†é…

```cpp
private:
    static void* operator new(std::size_t size) { return ::operator new(size); }
    static void operator delete(void* p) { ::operator delete(p); }
```

---

## å››ã€åªèƒ½åœ¨æ ˆä¸Šåˆ›å»ºå¯¹è±¡

```cpp
class StackOnly {
private:
    static void* operator new(std::size_t) = delete;
    static void  operator delete(void*) = delete;
    static void* operator new[](std::size_t) = delete;
    static void  operator delete[](void*) = delete;
    static void* operator new(std::size_t, void*) = delete;
public:
    StackOnly() = default;
    ~StackOnly() = default;
};
```

---

## äº”ã€ä¸‰ç§å¸¸è§æ€è·¯ä¸å¼±ç‚¹å¯¹æ¯”

| æ€è·¯ | æè¿° | å¼±ç‚¹ |
|------|------|------|
| æ„é€ å‡½æ•°ç§æœ‰åŒ– | ç¦æ­¢æ ˆä¸Šå£°æ˜ | delete ä¸å—æ§ï¼›è®¾è®¡ä¸ç›´è§‚ |
| ææ„å‡½æ•°ç§æœ‰åŒ– | ç¦æ­¢å¤–éƒ¨ delete | åŠŸèƒ½å¯è¡Œä½†é£æ ¼ä¸ç¬¦åˆâ€œnew/deleteâ€è¯­ä¹‰ |
| æ„é€ +ææ„ç§æœ‰ + å·¥å‚å‡½æ•° | âœ… æœ€æ¨è | å°è£…æ¸…æ™°ï¼Œå…¼å®¹æ™ºèƒ½æŒ‡é’ˆ |

---

## å…­ã€å¸¸è§é—®ç­”

### ğŸ§© Q1. new æ˜¯å¦ä¸€å®šè°ƒç”¨æ„é€ å‡½æ•°ï¼Ÿ
âœ… æ˜¯ã€‚

### ğŸ§© Q2. operator new ä¼šä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Ÿ
âŒ ä¸ä¼šã€‚

### ğŸ§© Q3. new è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œè®¿é—®æƒé™æ€ä¹ˆç®—ï¼Ÿ
æ„é€ å‡½æ•°æ˜¯ private â†’ å¤–éƒ¨æ— æ³• newï¼›ç±»å†…æˆ–å‹å…ƒå¯è®¿é—®ã€‚

### ğŸ§© Q4. delete çš„è®¿é—®æƒé™æ€ä¹ˆç®—ï¼Ÿ
ææ„å‡½æ•° private â†’ å¤–éƒ¨æ— æ³• deleteã€‚

### ğŸ§© Q5. ä¸ºä»€ä¹ˆ operator new/delete å¿…é¡»æ˜¯ staticï¼Ÿ
å› ä¸ºå®ƒä»¬æ‰§è¡Œäºå¯¹è±¡å­˜åœ¨å‰åï¼Œæ²¡æœ‰ this æŒ‡é’ˆã€‚

---

## ä¸ƒã€ç»¼åˆå¯¹æ¯”è¡¨

| ç‰¹æ€§ | åªèƒ½å †ä¸Š | åªèƒ½æ ˆä¸Š |
|------|-----------|-----------|
| æ„é€ å‡½æ•° | private | public |
| ææ„å‡½æ•° | private | public |
| operator new/delete | private æˆ–é»˜è®¤ | delete |
| åˆ›å»ºæ–¹å¼ | create() | æ ˆå˜é‡ |
| é”€æ¯æ–¹å¼ | æ™ºèƒ½æŒ‡é’ˆæˆ– destroy | è‡ªåŠ¨ä½œç”¨åŸŸé”€æ¯ |

---

## å…«ã€ä¸€å¥è¯æ€»ç»“

> - â€œææ„ç§æœ‰ â†’ ç¦æ­¢æ ˆä¸Šï¼›æ„é€ ç§æœ‰ â†’ ç¦æ­¢å¤–éƒ¨ newï¼›ç¦ç”¨ operator new â†’ ç¦æ­¢å †ä¸Šã€‚â€  
> - æœ€ä½³æ–¹æ¡ˆï¼šå †ä¸Šç±»ç”¨æ™ºèƒ½æŒ‡é’ˆå°è£…ï¼›æ ˆä¸Šç±»ç¦ç”¨ new/deleteã€‚

---

# ğŸ•“ ç‹¬ç«‹æ—¶é—´ç´¢å¼•è¡¨

| æ—¶é—´ | å†…å®¹ |
|------|------|
| 00:00â€“00:29 | é¢˜ç›®å¼•å…¥ä¸ç¼–è¯‘æœŸæ€è·¯ |
| 00:29â€“01:57 | æ„é€ å‡½æ•°ç§æœ‰åŒ–æ–¹æ¡ˆ |
| 02:00â€“03:37 | å·¥å‚å‡½æ•° create + æ‹·è´ç¦ç”¨ |
| 04:26â€“06:40 | ç§æœ‰ææ„å‡½æ•°æ–¹æ¡ˆ |
| 07:47â€“10:41 | æœ€ä½³å®è·µï¼šæ„é€ +ææ„ç§æœ‰ + create/destroy |
| 09:13â€“10:41 | unique_ptr æ”¹è¿›ç‰ˆ |
| 11:21â€“14:12 | æ ˆä¸Šç±»ï¼šç¦ç”¨ operator new/delete |
| 14:20â€“15:55 | æœ€ç»ˆæ€»ç»“ä¸é¢è¯•ç­”æ³• |
